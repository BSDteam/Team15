# ๐ญ ะะฃะกะะ-ัะผะตะฝะฐ โ Telegram-ะฑะพั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ัะผะตะฝะฐะผะธ

ะกะธััะตะผะฐ ะดะปั ะฐะฒัะพะผะฐัะธะทะฐัะธะธ ััััะฐ ัะผะตะฝ, ะธะฝัะธะดะตะฝัะพะฒ ะธ ะพัะฟััะบะพะฒ ะฝะฐ ะฟัะพะธะทะฒะพะดััะฒะตะฝะฝะพะผ ะฟัะตะดะฟัะธััะธะธ.  
ะะฐะทัะฐะฑะพัะฐะฝะพ ะดะปั ัะฐะบะฐัะพะฝะฐ ะฟะพ ัะฟัะฐะฒะปะตะฝะธั ะฟะตััะพะฝะฐะปะพะผ.

---

## ๐ ะคัะฝะบัะธะพะฝะฐะป

- ๐ ะะฒัะพัะธะทะฐัะธั ะฟะพ Telegram-ัะตะณั ั ัะฐะทะดะตะปะตะฝะธะตะผ ัะพะปะตะน:
  - **ะกะพัััะดะฝะธะบ** โ ะผะพะถะตั ัะพะพะฑัะฐัั ะพะฑ ะธะฝัะธะดะตะฝัะฐั
  - **ะะฐัะฐะปัะฝะธะบ ัะผะตะฝั** โ ัะฟัะฐะฒะปัะตั ัะผะตะฝะฐะผะธ, ะพัะฟััะบะฐะผะธ, ะฟัะพัะผะฐััะธะฒะฐะตั ะถััะฝะฐะป ะธะฝัะธะดะตะฝัะพะฒ
  - **ะะฐะดัะพะฒะธะบ (HR)** โ ัะฟัะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
- ๐ ะะตะณะธัััะฐัะธั ะธะฝัะธะดะตะฝัะพะฒ ั ะผะณะฝะพะฒะตะฝะฝัะผ ะพะฟะพะฒะตัะตะฝะธะตะผ
- ๐ฅ ะฃะฟัะฐะฒะปะตะฝะธะต ัะผะตะฝะฐะผะธ: ัะพะทะดะฐะฝะธะต, ะฝะฐะทะฝะฐัะตะฝะธะต ัะพัััะดะฝะธะบะพะฒ, ะฟัะพะฒะตัะบะฐ ะพัะฟััะบะพะฒ
- ๐๏ธ ะฃะฟัะฐะฒะปะตะฝะธะต ะพัะฟััะบะฐะผะธ ะธ ะฑะพะปัะฝะธัะฝัะผะธ
- ๐ ะััะฝะฐะป ะธะฝัะธะดะตะฝัะพะฒ ั ัะธะปัััะฐัะธะตะน ะฟะพ ะดะฐัะต
- ๐ ะะตะฝะตัะฐัะธั PDF-ะพััััะพะฒ ะฟะพ ะธะฝัะธะดะตะฝัะฐะผ ะทะฐ ะดะตะฝั
- ๐ ะะพะธัะบ ัะพัััะดะฝะธะบะพะฒ ะฟะพ ะคะะ ั ะพัะพะฑัะฐะถะตะฝะธะตะผ ัะตะบััะตะณะพ ััะฐัััะฐ
- ๐๏ธ ะะฝัะตัะฐะบัะธะฒะฝัะน ะบะฐะปะตะฝะดะฐัั ัะผะตะฝ ะธ ะพัะฟััะบะพะฒ

---

## ๐๏ธ ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.9+
- PostgreSQL 12+
- ะะธะฑะปะธะพัะตะบะธ Python: `aiogram`, `psycopg2`, `fpdf2`

---

## ๐ฅ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะฟัะพะตะบัะฐ
```bash
git clone https://github.com/ะฒะฐั-ะปะพะณะธะฝ/team15-rusal-shift.git
cd team15-rusal-shift
```

### 2. ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
```bash
python -m venv .venv
# Windows
.venv\Scripts\activate
# Linux/macOS
source .venv/bin/activate
```

### 3. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
```bash
pip install -r requirements.txt
```

ะกะพะดะตัะถะธะผะพะต `requirements.txt`:
```
aiogram==3.6.0
psycopg2-binary==2.9.9
python-dotenv==1.0.1
fpdf2==2.7.9
```

### 4. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```env
BOT_TOKEN=1234567890:AAHd...ะฒะฐั_ัะพะบะตะฝ_ะฑะพัะฐ

DB_HOST=localhost
DB_PORT=5432
DB_NAME=myapp_db
DB_USER=myapp_user
DB_PASSWORD=secure_password
```

> ๐ก **ะะฐะบ ะฟะพะปััะธัั BOT_TOKEN**:  
> 1. ะะฐะฟะธัะธัะต [@BotFather](https://t.me/BotFather) ะฒ Telegram  
> 2. ะัะฟะพะปะฝะธัะต `/newbot` โ ัะปะตะดัะนัะต ะธะฝััััะบัะธัะผ  
> 3. ะกะบะพะฟะธััะนัะต ัะพะบะตะฝ

### 5. ะะฝะธัะธะฐะปะธะทะฐัะธั ะฑะฐะทั ะดะฐะฝะฝัั

1. ะกะพะทะดะฐะนัะต ะะ ะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ PostgreSQL:
   ```sql
   CREATE DATABASE myapp_db;
   CREATE USER myapp_user WITH PASSWORD 'secure_password';
   GRANT ALL PRIVILEGES ON DATABASE myapp_db TO myapp_user;
   ```

2. ะัะฟะพะปะฝะธัะต ะฟะตัะฒะพะฝะฐัะฐะปัะฝัั ะทะฐะณััะทะบั ััััะบัััั ะธ ะดะฐะฝะฝัั:
   ```bash
   psql -U myapp_user -d myapp_db -f minimal_dump.sql
   ```
   > โ๏ธ ะะตัะตะด ะดะตะผะพะฝัััะฐัะธะตะน **ะทะฐะผะตะฝะธัะต `minimal_dump.sql`** ะฝะฐ ะฒะฐั ัะธะฝะฐะปัะฝัะน ะดะฐะผะฟ ั ัะธะฝัะตัะธัะตัะบะธะผะธ ะดะฐะฝะฝัะผะธ (ัะผ. `final_data_nov2025.sql`).

### 6. ะะฐะฟััะบ ะฑะพัะฐ
```bash
python bot.py
```

---

## ๐๏ธ ะกัะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั

![ะกัะตะผะฐ ะะ](docs/db_schema.png)

### ะะฟะธัะฐะฝะธะต ัะฐะฑะปะธั

| ะขะฐะฑะปะธัะฐ | ะะฐะทะฝะฐัะตะฝะธะต |
|--------|-----------|
| `users` | ะะพะปัะทะพะฒะฐัะตะปะธ ัะธััะตะผั: `telegram_tag`, `full_name`, `role`, `status`, `id` (telegram_user_id) |
| `workshops` | ะะฐััะตััะบะธะต/ัะตัะฐ |
| `shifts` | ะกะผะตะฝั: ะดะฐัะฐ, ะฒัะตะผั, ัะตั, ะผะฐััะตั (`tag`) |
| `shift_assignments` | ะะฐะทะฝะฐัะตะฝะธะต ัะพัััะดะฝะธะบะพะฒ ะฝะฐ ัะผะตะฝั |
| `employee_supervisor` | ะะตัะฐััะธั: ัะฒัะทั ัะพัััะดะฝะธะบ โ ะฝะฐัะฐะปัะฝะธะบ |
| `events` | ะะฝัะธะดะตะฝัั: ะพะฟะธัะฐะฝะธะต, ะฐะฒัะพั, ะดะฐัะฐ |
| `leave_records` | ะัะฟััะบะฐ ะธ ะฑะพะปัะฝะธัะฝัะต: ะฟะตัะธะพะด, ัะธะฟ |
| `notifications` | ะะพะณ ัะฒะตะดะพะผะปะตะฝะธะน ะผะตะถะดั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ |

> ๐ก **ะะปััะตะฒัะต ัะฒัะทะธ**:  
> - ะกะผะตะฝะฐ โ ะผะฐััะตั ัะตัะตะท `shifts.tag โ users.telegram_tag`  
> - ะกะพัััะดะฝะธะบ โ ะฝะฐัะฐะปัะฝะธะบ ัะตัะตะท `employee_supervisor`  
> - ะะฝัะธะดะตะฝั โ ะฐะฒัะพั ัะตัะตะท `events.reporter_telegram_tag โ users.telegram_tag`

---

## ๐งช ะขะตััะพะฒัะต ััััะฝัะต ะทะฐะฟะธัะธ

| Telegram-ัะตะณ | ะคะะ | ะะพะปั | ะะฐัะพะปั ะฝะต ััะตะฑัะตััั |
|--------------|-----|------|---------------------|
| `@smtg_wrong` | ะัะปะพะฒ ะะฝะดัะตะน ะะปะฐะดะธะผะธัะพะฒะธั | ะะฐัะฐะปัะฝะธะบ | โ |
| `@sstasbaldanov` | ะะฐะปะดะฐะฝะพะฒ ะกัะฐะฝะธัะปะฐะฒ ะะฐะปัะถะธะฝะธะผะฐะตะฒะธั | ะกะพัััะดะฝะธะบ | โ |
| `@Sunrise_ne_yveren` | ะะพะฝัะฐัะพะฒ ะะณะพัั ะะฒะณะตะฝัะตะฒะธั | ะกะพัััะดะฝะธะบ | โ |
| `@Boryakov` | ะะพััะบะพะฒ ะะธะบะธัะฐ ะะฝะดัะตะตะฒะธั | ะะฐะดัะพะฒะธะบ (HR) | โ |

> ๐ ะัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ัะถะต ะดะพะฑะฐะฒะปะตะฝั ะฒ ะะ. ะัะพััะพ ะฝะฐะฟะธัะธัะต ะฑะพัั `/start`.

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
team15-rusal-shift/
โโโ bot.py                  # ะขะพัะบะฐ ะฒัะพะดะฐ
โโโ config.py               # ะะฐะณััะทะบะฐ .env
โโโ db.py                   # ะะฐะฑะพัะฐ ั PostgreSQL
โโโ states.py               # FSM-ัะพััะพัะฝะธั
โโโ callbacks.py            # Callback-ะดะฐะฝะฝัะต
โโโ keyboards.py            # ะะตะฝะตัะฐัะธั ะบะปะฐะฒะธะฐััั
โ
โโโ services/               # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ user_service.py     # ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
โ   โโโ incident_service.py # ะะฝัะธะดะตะฝัั ะธ ัะฒะตะดะพะผะปะตะฝะธั
โ   โโโ shift_service.py    # ะกะผะตะฝั
โ   โโโ leave_service.py    # ะัะฟััะบะฐ
โ   โโโ employee_service.py # ะกัะฐัััั ะธ ะฟะพะธัะบ
โ   โโโ report_service.py   # ะะตะฝะตัะฐัะธั PDF
โ
โโโ handlers/               # ะะฑัะฐะฑะพััะธะบะธ Telegram
โ   โโโ main_menu.py        # /start ะธ ะณะปะฐะฒะฝะพะต ะผะตะฝั
โ   โโโ incident.py         # ะะตะณะธัััะฐัะธั ะธะฝัะธะดะตะฝัะพะฒ
โ   โโโ shifts/             # ะฃะฟัะฐะฒะปะตะฝะธะต ัะผะตะฝะฐะผะธ
โ   โโโ leaves/             # ะฃะฟัะฐะฒะปะตะฝะธะต ะพัะฟััะบะฐะผะธ
โ   โโโ incidents/          # ะััะฝะฐะป ะธ PDF
โ   โโโ employees/          # ะะพะธัะบ ัะพัััะดะฝะธะบะพะฒ
โ   โโโ calendar/           # ะะฐะปะตะฝะดะฐัั ัะผะตะฝ
โ
โโโ minimal_dump.sql        # ะกัััะบัััะฐ ะธ ัะตััะพะฒัะต ะดะฐะฝะฝัะต
โโโ requirements.txt        # ะะฐะฒะธัะธะผะพััะธ
โโโ .env.example            # ะจะฐะฑะปะพะฝ .env
```

---

## ๐ ะัะธะผะตัะฐะฝะธั ะดะปั ะถััะธ

- ะะพั ะธัะฟะพะปัะทัะตั **ัะพะปัะบะพ ะพัะธัะธะฐะปัะฝัะต Telegram-ะธะดะตะฝัะธัะธะบะฐัะพัั** (`@username`), ััะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะฑะตะทะพะฟะฐัะฝะพััั.
- ะัะต ะพะฟะตัะฐัะธะธ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั ะฟัะพัะพะดัั ัะตัะตะท **ัะพะฝะบะธะน ัะปะพะน `services`**, ััะพ ะณะฐัะฐะฝัะธััะตั ัะฐะทะดะตะปะตะฝะธะต ะฑะธะทะฝะตั-ะปะพะณะธะบะธ ะธ Telegram-ะธะฝัะตััะตะนัะฐ.
- PDF-ะพััััั ะณะตะฝะตัะธัััััั ั ะฟะพะดะดะตัะถะบะพะน ะบะธัะธะปะปะธัั ัะตัะตะท ะฒัััะพะตะฝะฝัะน ััะธัั DejaVu.
- ะกะธััะตะผะฐ **ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตั `telegram_user_id`** ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต, ััะพ ะฟะพะทะฒะพะปัะตั ะพัะฟัะฐะฒะปััั ะฟะตััะพะฝะฐะปัะฝัะต ัะฒะตะดะพะผะปะตะฝะธั.
- ะัะต ะบัะธัะตัะธะธ ะขะ ัะตะฐะปะธะทะพะฒะฐะฝั ะธ ะฟัะพัะตััะธัะพะฒะฐะฝั ะฝะฐ ัะธะฝัะตัะธัะตัะบะธั ะดะฐะฝะฝัั ะทะฐ ะฝะพัะฑัั 2025 ะณะพะดะฐ.

ะฃะดะฐัะธ ะฝะฐ ะฟัะพะธะทะฒะพะดััะฒะต! ๐
```